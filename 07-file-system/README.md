# 파일시스템

리눅스에서는 저장 장치 안의 데이터에 접근 할 때 일반적으로 직접 저장 장치에 접근하지 않고 편의를 위해 파일시스템을 통해 접근한다.

컴퓨터 시스템에 파일시스템이 있는 것은 당연한 일처럼 여겨지지만, 파일시스템이 없는 세상을 상상해보며 **파일시스템의 필요성**에 대해 살펴보자.

저장 장치의 기능은 단순하게 말하면 '저장 장치 안에 지정된 주소에 대해 특정 사이즈의 데이터를 읽거나 쓰는 것'이다. 만약 파일시스템이 없다면 저장 장치에 쓰고 읽기 위해서는 다음과 같은 정보를 별도로 관리해야 한다.

![모든 데이터에 대해 보관한 주소, 사이즈를 관리할 필요가 있음](/images/07-file-system/7-2.png)  

이러한 복잡한 처리를 피하고자, 어디에 어느 정도의 데이터가 있는지, 어디가 빈 영역인지를 관리하는 방식이 파일시스템이다.

### 파일 시스템의 역할
파일 시스템은 사용자에 의미가 있는 하나의 데이터를 **이름, 위치, 사이즈** 등의 **보조 정보**를 추가하여 **파일**이라는 단위로 관리한다. 어느 장소에 어떤 파일을 배피할 지 등의 데이터 구조는 사양으로 미리 정하며, 커널 내부에서 파일시스템을 다루기 위한 처리가 사양을 바탕으로 데이터를 다루게 된다.

![단순한 파일시스템의 예](/images/07-file-system/7-3.png)  

사용자가(정확히는 사용자의 프로세스가) 파일 읽기 시스템 콜을 사용하여 파일 이름과 파일상의 오프셋 및 사이즈를 지정하면 파일시스템을 다루는 처리가 해당하는 데이터를 찾아서 사용자에게 전달한다.

![파일 이름, 파일상의 오프셋, 사이즈를 지정하면 해당하는 데이터를 읽을 수 있음](/images/07-file-system/7-4.png)  

### 리눅스의 파일 시스템
파일을 카테고리 별로 정리할 수 있도록 리눅스의 파일시스템에는 디렉터리(directory)라고 부르는 파일을 보관하는 특수한 파일이 존재한다. 이를 위해 리눅스의 파일시스템은 **트리 구조**로 되어 있다.

![트리 구조의 파일시스템](/images/07-file-system/7-5.png) 

### 파일시스템 콜(call)
리눅스가 다루는 파일시스템은 1개가 아니라 'ext4', 'XFS', 'Btrfs' 등 여러 개의 파일시스템을 다룰 수 있다. 각 파일시스템은 저장 장치의 데이터 구조 및 그것을 처리하기 위한 프로그램이 다르며, 다룰 수 있는 파일의 사이즈, 파일시스템의 사이즈, 개개의 처리(파일 작성, 삭제, 읽기, 쓰기 등)의 속도 등도 다르다.

하지만 **어떤 파일시스템이라도 사용자가 다음과 같은 시스템 콜을 호풀한다면 통일된 인터페이스로 접근이 가능하다**.

* 파일의 작성, 삭제: create(), unlink()
* 파일을 열기, 닫기: open(), close()
* 데이터 읽기: read()
* 데이터 쓰기: write()
* 파일 이동: lseek()
* 위에 언급한 것 이외의 파일 시스템에 의존적인 특수한 처리: ioctl()

위의 시스템 콜이 호출되면 다음과 같은 순서로 파일의 데이터가 읽어진다.

1. 커널 내의 모든 파일시스템 공통 처리가 동작하고 대상 파일의 파일시스템을 판별한다.
2. 각 파일시스템을 처리하는 프로세스를 호출하여 시스템 콜에 대응되는 처리를 한다.
3. 데이터의 읽기를 하는 경우 디바이스 드라이버에 처리를 의뢰한다.
4. 디바이스 드라이버가 데이터를 읽어들인다.

![파일시스템에 관계없이 통일된 인터페이스로 접근 가능함](/images/07-file-system/7-6.png) 

# 데이터와 메타데이터
파일시스템에는 데이터(data)와 메타데이터(metadata)라는 두 종류의 데이터가 있다.
* 데이터: 사용자가 작성한 문서나 사진, 동영상 프로그램 등의 내용
* 메타데이터: 파일의 보조 정보
  * 파일의 이름이
  * 저장 장치 내에 위치 사이즈
  * 종류: 데이터를 보관하는 일반 파일 or 디렉토리 or 다른 종류의 파일인지 판별하는 정보
  * 시간 정보: 작성한 시간, 최후에 접근한 시간, 최후에 내용이 변경된 시간
  * 권한 정보: 사용자 접근 권한

  >(참고) `df` 명령어로 얻은 파일시스템의 스토리지 사용량은 파일 시스템에 작성한 모든 파일의 합계 사이즈만이 아니라 **메타데이터의 사이즈도 더해지므로** 주의가 필요하다.

![파일시스템에 관계없이 통일된 인터페이스로 접근 가능함](/images/07-file-system/code1.png) 

# 용량 제한